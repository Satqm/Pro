I'll help you fix the hours calculation logic and remove the licensing system. Here's a step-by-step guide to update your code:

PART 1: FIX HOURS & WEIGHTAGE CALCULATION LOGIC

Change 1: Add manualEntry property to subtopic data structure

Find this section in toggleTopicStatus function:

```javascript
if (nextStatus === 'completed') {
    // Mark all subtopics as completed
    Object.keys(topic.subtopics).forEach(subtopicName => {
        topic.subtopics[subtopicName].completed = true;
        // Reset hours to weightage-based calculation
        topic.subtopics[subtopicName].actualHours = 0;
    });
}
```

Replace with:

```javascript
if (nextStatus === 'completed') {
    // Mark all subtopics as completed but preserve manual hours
    Object.keys(topic.subtopics).forEach(subtopicName => {
        const subtopic = topic.subtopics[subtopicName];
        
        // Only auto-calculate if no manual hours exist
        if (!subtopic.actualHours || subtopic.actualHours === 0) {
            // Calculate weightage-based hours
            const subjectData = syllabusData[subjectId];
            const syllabusTopic = subjectData.topics.find(t => t.name === topicName);
            
            if (syllabusTopic) {
                const subjectPlannedHours = userStudyPlan?.subjectHours?.[subjectId] || 0;
                const topicWeightage = syllabusTopic.weightage;
                const topicPlannedHours = (topicWeightage / 100) * subjectPlannedHours;
                
                const subtopicData = syllabusTopic.subtopics.find(s => s.name === subtopicName);
                if (subtopicData) {
                    const subtopicWeightage = subtopicData.weight;
                    subtopic.actualHours = (subtopicWeightage / 100) * topicPlannedHours;
                }
                subtopic.manualEntry = false; // Auto-calculated
            }
        } else {
            subtopic.manualEntry = true; // User entered hours manually
        }
        
        subtopic.completed = true;
    });
} else if (nextStatus === 'not-started') {
    // When marking as not-started, only reset auto-calculated hours
    Object.keys(topic.subtopics).forEach(subtopicName => {
        const subtopic = topic.subtopics[subtopicName];
        
        // Only reset if NOT manually entered
        if (!subtopic.manualEntry || subtopic.manualEntry === false) {
            subtopic.actualHours = 0;
        }
        subtopic.completed = false;
    });
}
```

Change 2: Update saveAllProgress function

Find this section in saveAllProgress function:

```javascript
// Update hours
userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].actualHours = hours;

// Also mark as manual entry if hours were just entered (prevHours was 0)
if (prevHours === 0 && hours > 0) {
    userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].manualEntry = true;
}
```

Replace with:

```javascript
// Update hours
userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].actualHours = hours;

// Mark as manual entry if user enters any hours (and we're not auto-calculating)
// Check if this is a fresh entry OR if user is changing existing hours
if (hours > 0) {
    if (prevHours === 0 || subtopicRef.manualEntry === true) {
        userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].manualEntry = true;
    }
} else if (hours === 0 && subtopicRef.manualEntry === true) {
    // If user clears manual hours, reset the flag
    userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].manualEntry = false;
}
```

Change 3: Add weightage validation function

Add this function after other helper functions:

```javascript
function validateAndNormalizeTopicWeightages(subjectId) {
    const topics = syllabusData[subjectId].topics;
    const totalWeightage = topics.reduce((sum, topic) => sum + topic.weightage, 0);
    
    if (totalWeightage !== 100) {
        console.warn(`Subject ${subjectId} weightage sum is ${totalWeightage}%, normalizing to 100%`);
        
        // Normalize weightages
        topics.forEach(topic => {
            topic.weightage = Math.round((topic.weightage / totalWeightage) * 100 * 100) / 100;
        });
        
        // Adjust the last topic to ensure exact 100%
        const newTotal = topics.reduce((sum, topic) => sum + topic.weightage, 0);
        if (newTotal !== 100) {
            topics[topics.length - 1].weightage += (100 - newTotal);
            topics[topics.length - 1].weightage = Math.round(topics[topics.length - 1].weightage * 100) / 100;
        }
    }
    
    // Validate subtopic weightages
    topics.forEach(topic => {
        const subtopicTotal = topic.subtopics.reduce((sum, st) => sum + st.weight, 0);
        if (subtopicTotal !== 100) {
            console.warn(`Topic "${topic.name}" subtopic weightage sum is ${subtopicTotal}%, normalizing to 100%`);
            
            topic.subtopics.forEach(subtopic => {
                subtopic.weight = Math.round((subtopic.weight / subtopicTotal) * 100 * 100) / 100;
            });
            
            // Adjust last subtopic
            const newSubTotal = topic.subtopics.reduce((sum, st) => sum + st.weight, 0);
            if (newSubTotal !== 100) {
                topic.subtopics[topic.subtopics.length - 1].weight += (100 - newSubTotal);
                topic.subtopics[topic.subtopics.length - 1].weight = 
                    Math.round(topic.subtopics[topic.subtopics.length - 1].weight * 100) / 100;
            }
        }
    });
}
```

Change 4: Initialize weightage validation

Find the syllabusData initialization and add this after it:

```javascript
// Validate all weightages sum to 100%
for (const subjectId in syllabusData) {
    validateAndNormalizeTopicWeightages(subjectId);
}
```

Change 5: Add visual indicator for manual entries

Update the subtopic rendering in renderSubject function:

```javascript
return `<div class="subtopic-item ${subtopicProgress.manualEntry ? 'manual-entry' : ''}">
    <div class="subtopic-info">
        <div class="subtopic-name">${subtopic.name}
            ${subtopicProgress.manualEntry ? 
                '<span class="manual-entry-indicator" title="Manually entered hours">M</span>' : 
                ''}
        </div>
        <div class="subtopic-details">
            <span>Weight: ${subtopic.weight}%</span>
            ${completed ? '<span style="color: var(--success);"><i class="fas fa-check"></i> Completed</span>' : ''}
        </div>
    </div>
    <div class="subtopic-actions">
        <div class="time-info">
            <div class="actual-time-input">
                <input type="number" 
                       id="time-${subjectId}-${topic.name.replace(/\s+/g, '-')}-${subtopic.name.replace(/\s+/g, '-')}"
                       value="${hours.toFixed(1)}"
                       min="0" 
                       step="0.5"
                       placeholder="Hours"
                       style="width: 100px;"
                       ${subtopicProgress.manualEntry ? 'class="manual-input"' : ''}>
                <span>hrs</span>
            </div>
        </div>
    </div>
</div>`;
```

PART 2: REMOVE LICENSING SYSTEM

Change 1: Simplify the welcome screen HTML

Find this entire section:

```html
<!-- License Section -->
<div class="license-section">
    <h3 style="text-align: center; margin-bottom: 20px; color: var(--primary);">
        <i class="fas fa-key"></i> License Activation
    </h3>
    
    <div class="license-input-group">
        <input type="text" 
               id="user-name-input" 
               class="license-input" 
               placeholder="Enter your name"
               maxlength="50">
        <input type="text" 
               id="license-input" 
               class="license-input" 
               placeholder="Enter your license key"
               maxlength="64">
        <button class="license-activate-btn" id="license-activate-btn">
            <i class="fas fa-check"></i> Activate
        </button>
    </div>
    
    <!-- ... (ALL LICENSE-RELATED CONTENT) ... -->
</div>

<!-- Premium Features -->
<div class="premium-features">
    <!-- ... (REMOVE ENTIRE SECTION) ... -->
</div>

<!-- Demo Credentials -->
<div class="demo-credentials">
    <!-- ... (REMOVE ENTIRE SECTION) ... -->
</div>
```

Replace with:

```html
<!-- User Name Input -->
<div class="name-input-section">
    <h3 style="text-align: center; margin-bottom: 20px; color: var(--primary);">
        <i class="fas fa-user"></i> Enter Your Name
    </h3>
    
    <div class="name-input-group">
        <input type="text" 
               id="user-name-input" 
               class="name-input" 
               placeholder="Enter your name"
               maxlength="50"
               required>
        <button class="start-tracking-btn" id="start-tracking-btn">
            <i class="fas fa-play-circle"></i> Start Tracking
        </button>
    </div>
    
    <p style="text-align: center; margin-top: 15px; font-size: 14px; color: var(--gray);">
        Your data is stored locally on your device
    </p>
</div>
```

Change 2: Update CSS for simplified welcome screen

Find this CSS section:

```css
.license-input-group {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.license-input {
    flex: 1;
    padding: 16px 20px;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s;
}

.license-activate-btn {
    padding: 16px 30px;
    background: var(--gradient);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    white-space: nowrap;
}
```

Add new CSS for name input:

```css
.name-input-section {
    margin: 30px 0;
    padding: 25px;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 16px;
    border: 2px solid #e9ecef;
}

.name-input-group {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.name-input {
    flex: 1;
    padding: 16px 20px;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s;
}

.name-input:focus {
    border-color: var(--secondary);
    outline: none;
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
}

.start-tracking-btn {
    padding: 16px 30px;
    background: var(--gradient);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    white-space: nowrap;
}

.start-tracking-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
}
```

Change 3: Remove license-related JavaScript

Remove these functions completely:

1. initializeLicenseSystem()
2. loadLicenseState()
3. calculateTrialDaysLeft()
4. setupLicenseEventListeners()
5. checkLicenseOnStartup()
6. validateLicense()
7. activateLicense()
8. useDemoLicense()
9. showLicenseStatus()
10. enableAppAccess()
11. checkAccess()
12. updateLicenseModal()

Change 4: Simplify JavaScript initialization

Find this in DOMContentLoaded:

```javascript
// Initialize license system
initializeLicenseSystem();
```

Replace with:

```javascript
// Load user data
setupEventListeners();
loadUserData();
loadDefaultContent();

// Update UI
updateUserUI();
```

Change 5: Update setupEventListeners function

Find the license event listeners:

```javascript
// License event listeners
document.getElementById('license-activate-btn').addEventListener('click', activateLicense);
document.getElementById('use-demo-btn').addEventListener('click', useDemoLicense);
document.getElementById('get-license-btn').addEventListener('click', () => {
    window.open('https://wa.me/919142300129', '_blank');
});
document.getElementById('buy-now-btn').addEventListener('click', () => {
    window.open('https://wa.me/919142300129', '_blank');
});
document.getElementById('license-toggle').addEventListener('click', () => {
    const details = document.getElementById('license-details');
    const icon = document.getElementById('license-toggle').querySelector('i');
    details.classList.toggle('active');
    icon.classList.toggle('fa-chevron-down');
    icon.classList.toggle('fa-chevron-up');
});
document.getElementById('license-input').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        activateLicense();
    }
});
document.getElementById('license-info-btn').addEventListener('click', () => {
    document.getElementById('license-modal').classList.add('active');
    updateLicenseModal();
});
document.getElementById('license-close').addEventListener('click', () => {
    document.getElementById('license-modal').classList.remove('active');
});
document.getElementById('upgrade-now').addEventListener('click', () => {
    window.open('https://wa.me/919142300129', '_blank');
});
```

Replace with:

```javascript
// Start tracking button
document.getElementById('start-tracking-btn').addEventListener('click', () => {
    const userName = document.getElementById('user-name-input').value.trim();
    if (!userName) {
        alert('Please enter your name to continue');
        return;
    }
    
    currentUser.name = userName;
    currentUser.initials = userName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
    DataStorage.save('user', currentUser);
    
    welcomeContainer.style.display = 'none';
    appContainer.style.display = 'block';
    updateDashboard();
    scheduleNotifications();
});

// Remove license info button from user dropdown
document.getElementById('license-info-btn').parentElement.remove();
```

Change 6: Remove license modal HTML

Find and remove this entire section:

```html
<!-- License Info Modal -->
<div class="modal license-modal" id="license-modal">
    <!-- ... (REMOVE ENTIRE MODAL) ... -->
</div>
```

Change 7: Update footer

Find this in footer:

```html
<div class="footer-copyright">
    Professional Offline Version • © 2026 Satyam Kumar • 
    <span id="footer-license-status">License: Active</span>
</div>
```

Replace with:

```html
<div class="footer-copyright">
    Professional Offline Study Management System • © 2026 Built by Satyam Kumar
</div>
```

Change 8: Remove license status from header

Find this in header:

```html
<div class="user-status">
    <span id="license-status-text">Premium</span>
    <span id="trial-status" style="display: none;">• Trial</span>
</div>
```

Replace with:

```html
<div class="user-status">
    CA Final Student
</div>
```

Change 9: Update user dropdown menu

Find this in user dropdown:

```html
<a href="#" id="license-info-btn"><i class="fas fa-key"></i> License Info</a>
```

Remove this line completely.

PART 3: ADD HOURS TRACKING LOGIC

Change 1: Add hours calculation helper function

Add this function after other helper functions:

```javascript
function calculateAutoHours(subjectId, topicName, subtopicName) {
    const subjectData = syllabusData[subjectId];
    const syllabusTopic = subjectData.topics.find(t => t.name === topicName);
    
    if (!syllabusTopic) return 0;
    
    const subjectPlannedHours = userStudyPlan?.subjectHours?.[subjectId] || 0;
    const topicWeightage = syllabusTopic.weightage;
    const topicPlannedHours = (topicWeightage / 100) * subjectPlannedHours;
    
    const subtopicData = syllabusTopic.subtopics.find(s => s.name === subtopicName);
    if (subtopicData) {
        const subtopicWeightage = subtopicData.weight;
        return (subtopicWeightage / 100) * topicPlannedHours;
    }
    
    return 0;
}
```

Change 2: Update hours display in subtopic rendering

Update the hours display logic in renderSubject function:

```javascript
const hours = subtopicProgress.actualHours || 0;
const completed = subtopicProgress.completed || false;
const isManual = subtopicProgress.manualEntry === true;

// Calculate what the auto-calculated hours would be
const autoHours = calculateAutoHours(subjectId, topic.name, subtopic.name);

// Display logic: show manual hours if they exist, otherwise show auto-calculated
const displayHours = isManual ? hours : autoHours;
```

Key Logic Summary:

1. Manual Hours Preservation: When manualEntry: true, hours are NEVER overwritten by weightage calculations
2. Auto-Calculation: Only happens when actualHours is 0/null/undefined and user hasn't entered manual hours
3. Status Changes: Reset only affects auto-calculated hours, preserves manual entries
4. Weightage Validation: Ensures all topic weightages sum to exactly 100%
5. No Duplicate Calculation: Saving multiple times doesn't inflate hours
6. Visual Indicators: Manual entries show "M" badge and different styling

These changes ensure your app:

· Never overwrites manually entered hours
· Applies weightage calculations only once per topic
· Maintains accurate total hours across subjects
· Provides clear visual distinction between manual and auto-calculated hours
