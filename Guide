Looking at the code, I can identify the main issues and provide fixes. The problems are in the toggleTopicStatus function and saveAllProgress function.

PROBLEM 1: In toggleTopicStatus function (Lines ~2510-2610)

When you mark a topic as "completed", it overwrites your manual hours with weightage-based hours.

FIX:

Find this block in toggleTopicStatus function:

```javascript
if (nextStatus === 'completed') {
    // Mark all subtopics as completed with calculated hours
    Object.keys(topic.subtopics).forEach(subtopicName => {
        const subtopic = topic.subtopics[subtopicName];
        
        // Calculate weightage-based hours
        const subjectData = syllabusData[subjectId];
        const syllabusTopic = subjectData.topics.find(t => t.name === topicName);
        
        if (syllabusTopic) {
            const subjectPlannedHours = userStudyPlan?.subjectHours?.[subjectId] || 0;
            const topicWeightage = syllabusTopic.weightage;
            const topicPlannedHours = (topicWeightage / 100) * subjectPlannedHours;
            
            const subtopicData = syllabusTopic.subtopics.find(s => s.name === subtopicName);
            if (subtopicData) {
                const subtopicWeightage = subtopicData.weight;
                subtopic.actualHours = (subtopicWeightage / 100) * topicPlannedHours;
            }
        }
        
        subtopic.completed = true;
    });
}
```

REPLACE with this corrected version:

```javascript
if (nextStatus === 'completed') {
    // Mark as completed but PRESERVE any existing manual hours
    Object.keys(topic.subtopics).forEach(subtopicName => {
        const subtopic = topic.subtopics[subtopicName];
        
        // ONLY calculate weightage hours if user hasn't entered any hours (0 or undefined)
        if (!subtopic.actualHours || subtopic.actualHours === 0) {
            // Find topic data from syllabus to get weightage
            const subjectData = syllabusData[subjectId];
            const syllabusTopic = subjectData.topics.find(t => t.name === topicName);
            
            if (syllabusTopic) {
                // Calculate topic planned hours based on subject distribution
                const subjectPlannedHours = userStudyPlan?.subjectHours?.[subjectId] || 0;
                const topicWeightage = syllabusTopic.weightage;
                const topicPlannedHours = (topicWeightage / 100) * subjectPlannedHours;
                
                // Find subtopic data to get its weight
                const subtopicData = syllabusTopic.subtopics.find(s => s.name === subtopicName);
                if (subtopicData) {
                    const subtopicWeightage = subtopicData.weight;
                    // Calculate hours: subtopic weight * topic planned hours
                    subtopic.actualHours = (subtopicWeightage / 100) * topicPlannedHours;
                } else {
                    // Fallback: distribute equally
                    const numSubtopics = Object.keys(topic.subtopics).length;
                    subtopic.actualHours = topicPlannedHours / numSubtopics;
                }
            }
        }
        
        // Mark as completed (regardless of whether hours were auto-calculated or manual)
        subtopic.completed = true;
    });
}
```

PROBLEM 2: In saveAllProgress function (Lines ~2570-2620)

Need to track manual entries and never overwrite them.

FIX:

Find this block in saveAllProgress function:

```javascript
if (hours >= 0) {
    // Ensure progress structure exists
    if (!userProgress.subjects[subjectId]) {
        userProgress.subjects[subjectId] = { topics: {}, completedTopics: 0, totalTopics: syllabusData[subjectId].topics.length };
    }
    if (!userProgress.subjects[subjectId].topics[topicName]) {
        userProgress.subjects[subjectId].topics[topicName] = { status: 'not-started', subtopics: {} };
    }
    if (!userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName]) {
        userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName] = { 
            actualHours: 0, 
            completed: false
        };
    }
    
    // Update hours
    userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].actualHours = hours;
    
    // Auto-mark as completed if hours > 0
    userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].completed = hours > 0;
    
    // Auto-mark topic as in-progress if hours added
    if (hours > 0 && userProgress.subjects[subjectId].topics[topicName].status === 'not-started') {
        userProgress.subjects[subjectId].topics[topicName].status = 'inprogress';
    }
    
    savedCount++;
}
```

REPLACE with this corrected version:

```javascript
if (hours >= 0) {
    // Ensure progress structure exists
    if (!userProgress.subjects[subjectId]) {
        userProgress.subjects[subjectId] = { topics: {}, completedTopics: 0, totalTopics: syllabusData[subjectId].topics.length };
    }
    if (!userProgress.subjects[subjectId].topics[topicName]) {
        userProgress.subjects[subjectId].topics[topicName] = { status: 'not-started', subtopics: {} };
    }
    if (!userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName]) {
        userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName] = { 
            actualHours: 0, 
            completed: false,
            manualEntry: false  // Track if this was manually entered
        };
    }
    
    // Get previous hours to detect changes
    const prevHours = userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].actualHours || 0;
    
    // Update hours
    userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].actualHours = hours;
    
    // Mark as manual entry if user entered/changed hours (and it's different from weightage-based)
    if (hours !== prevHours) {
        userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].manualEntry = true;
    }
    
    // Auto-mark as completed if hours > 0
    userProgress.subjects[subjectId].topics[topicName].subtopics[subtopicName].completed = hours > 0;
    
    // Auto-mark topic as in-progress if hours added
    if (hours > 0 && userProgress.subjects[subjectId].topics[topicName].status === 'not-started') {
        userProgress.subjects[subjectId].topics[topicName].status = 'inprogress';
    }
    
    savedCount++;
}
```

PROBLEM 3: Need to update the "not-started" case too

Find this block in toggleTopicStatus function:

```javascript
} else if (nextStatus === 'not-started') {
    // Reset hours and completion
    Object.keys(topic.subtopics).forEach(subtopicName => {
        const subtopic = topic.subtopics[subtopicName];
        subtopic.actualHours = 0;
        subtopic.completed = false;
    });
}
```

REPLACE with:

```javascript
} else if (nextStatus === 'not-started') {
    // When marking as not-started, ONLY reset hours that were auto-calculated
    // NEVER reset manually entered hours
    Object.keys(topic.subtopics).forEach(subtopicName => {
        const subtopic = topic.subtopics[subtopicName];
        
        // Only reset hours if they were NOT manually entered
        if (!subtopic.manualEntry) {
            subtopic.actualHours = 0;
        }
        subtopic.completed = false;
    });
}
```

SUMMARY OF CHANGES:

1. In toggleTopicStatus function - Only calculate weightage hours if user hasn't entered any hours (0 or undefined)
2. In saveAllProgress function - Track manual entries with a manualEntry flag
3. In both functions - Never overwrite manually entered hours
4. When marking "not-started" - Only reset auto-calculated hours, keep manual hours

These changes ensure:

· ✅ Manual hours entered by user are ALWAYS preserved
· ✅ Weightage-based calculation only happens when no manual hours exist
· ✅ Dashboard shows actual hours (manual or auto-calculated)
· ✅ No duplicate hours or conflicts between manual and weightage calculations
